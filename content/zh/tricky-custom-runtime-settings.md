---
title: "Mendix 运行时的三维自定义设置"
parent: "自定义设置"
description: "描述比正常更难配置的自定义设置。"
tags:
  - "支持"
  - "自定义设置"
---

## 1 导言

Mendix有许多自定义设置，大多数都在 [运行时间自定义](/refguide/custom-settings) 中描述。

然而，一些较常用的自定义设置可能会被误解或产生人们可能无法预料的影响。 这就是为什么我们希望对这些环境给予一定程度的特别关注，并更全面地解释改变这些环境的后果。

## 2 次会话持续时间 {#session-duration}

### 2.1 Web 客户端设置

以下设置影响Mendix 网页客户端的行为：

| 名称             | 描述                                                                                                                                                               | 默认值  |
| -------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---- |
| `启用 KeepAlive` | 定义为防止会话超时是否在 `会话超时`/2 毫秒，Web 客户端是否发送了存活请求。 浏览器中的每个单击都可以使用 `KeepAlive`。 禁用此属性将导致用户在 `session超时` 毫秒不活动后自动登出(默认 10 分钟), 即使浏览器仍然打开. 在下一节中查看 `SessionTimeout` 获取更多信息。 | true |

### 2.2 一般设置

以下自定义设置可以配置：

| 名称               | 描述                                                               | 默认值            |
| ---------------- | ---------------------------------------------------------------- | -------------- |
| `会话超时`           | 定义会话在多长时间后无效(毫秒)。 在这段时间过后，届会将适用于除名。 直到下次集群管理员评估活动会话时，会话才会被摧毁。    | 600 000(10分钟)  |
| `LivedSession超时` | 此设置与 `SessionTimeout`相同，但是专门适用于离线第一个渐进式网络应用程序。                   | 604800000 (7天) |
| `集群管理动作间隔`       | 用于执行所有集群管理器操作的间隔(毫秒)。 这些动作包括解除对用户的屏蔽和移除无效会话。 如果没有指定，则间隔为 `会期超时`。 | 300 000(5分钟)   |

增加会话超时可以提高用户体验，特别是在移动设备上。 重要的是要牢记，用来向用户提供数据的实体或在用户执行微流时创建或检索的实体与该用户的会话绑在一起。 而且，这些实体可以长期留在记忆中。 当用户退出时，这些实体将从内存中移除，但如果用户闲置但没有退出，例如： 如果他们在执行其他任务时离开浏览器选项卡打开，或者只是关闭浏览器而不登出， 会话超时可以作为防止空闲会话将内存使用绑定的一种保护措施。 通过设置 `启用KeepAlle` 自定义设置为false也可以缓解。 在大多数浏览器中，此设置将确保任何闲置的浏览器标签也会受到会话超时的影响。

由于会话的频率超时检查和其他重要事件与 `ClusterManagerActionInterval`相关， 当值增加很多时不使用半个会话超时的默认值是有意义的(例如) (24小时或更长时间)。 在 `ClusterManagerActionInterval`上最大值可能是有意义的。 不论 `会期超时` 的值设定。 大约有15分钟，但最终这将取决于应用程序的功能要求。

由于无国籍的运行时间，由于两个原因，造成问题的内存使用的潜力已经减少。 第一个原因是能够在横向环境中运行。 多运行时将意味着意外的内存使用量在运行时也会被分割，减少任何空闲用户会话的影响。 但主要(和第二个)原因是，大多数内存使用情况已转移到客户端。 因此而不是内存中的所有实体最终在应用程序节点上， 一大部分最终将在客户端的浏览器中。 这将大大减少应用程序节点可能因增加 `会期超时` 默认值到更高的值而造成的压力。

提高会话超时可能影响的另一个重要问题是您的 Mendix 许可证所规定的用户限制。 较长的会话可能意味着在任何时间都有更多的并行用户。 在决定您需要运行您的应用程序的许可证的具体细节时，要记住这一点。

最后，还需要考虑安全问题。 闲置会话意味着，如果用户不遵守标准安全程序，会话可能会被劫持。 如果他们在任何特定时间离开计算机，然后不在计算机上停留， 任何能够实际访问该用户计算机的人都可以偷窃或使用它，并且能够为了自己的利益而利用会话。 使用默认会话超时值，这个风险会降低，因为实际访问的窗口限制得多(含义) a 会议超时24小时的风险大于会议超时10分钟的风险)。 有多少关注将取决于应用程序的核心业务目标和在应用中工作的人的类型。 例如，信息技术专业人员应当比大多数其他用户群体更有可能遵循标准的安全程序。

因此，在改变这些价值时，务必牢记上述所有内容。 此外，请确保你在作出改变任何这些价值的决定时考虑到了正确的考虑。

## 3 查询日志

### 3.1 数据库设置：共同设置

| 名称                 | 描述                                                                                                                                                      | 默认值 |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------- | --- |
| `LogMinDuration查询` | 定义数据库查询是否通过 `ConnectionBus_Queries` 日志节点登录，如果它们在这里指定的毫秒数后完成。 默认情况下，只记录关于 SQL 查询的记录。 将 `ConnectionBus_Queries` 日志节点的日志级别设置为 TRACE 以显示更多关于导致此查询的页面或微流的信息。 |     |

`LogMinDurationQuery` 可能是一个非常有用的工具，用于检测比预期时间长的查询。 对于仅在应用程序中使用的数据增长和由应用程序使用的数据增长后需要更长时间的查询，这特别有用。 因为这可能意味着查询只会在几个月的使用后变得较慢，而且可能还没有在发布前的性能测试中出现。 确定查询速度慢取决于您正在运行的应用程序类型。 但一般来说，任何直接影响到使用应用程序的用户的查询(意味着， 如果不是一个后台进程，那么它将有一个较低的阈值来确定它比后台中运行的查询更慢。 例如， 需要5秒加载才能选择任何东西的下拉菜单比后台生成的 PDF 需要8秒而不是4秒的差很多，因为需要5秒而不是1秒。

在 Mendix Cloud，我们选择了一个默认值为 10000(意指，10 秒)。 任何这类查询都会在应用程序的前端显现出来。 如果您的应用程序没有后台进程，这个值可能太高。 另一方面，如果您的应用程序正在运行许多背景流程，用户之间的互动最小，这个值可能太低。 最后，要设置的正确值将取决于您应用的功能要求，并需要相应设置。

此设置的最重要部分是定期检查应用程序日志中超过此值的任何查询，并在它们被认为有问题时加以解决。 设置此值而不对其采取后续行动，是非常有用的，也不会设置值。 缓慢运行的查询可能会对用户体验、受其影响的任何行动的通过产生不利影响。 应用程序的内存使用率, 应用程序的 CPU 使用率, 甚至在极端情况下可能导致停用。 鉴于所有这些， Mendix 强烈建议将此值设置为一个对您的应用程序有意义的数字，并跟进已记录的任何查询。

您可以通过在您的应用程序日志中寻找以下短语来找到这些日志条目： **查询在** 中。 短语将出现在这样的示例中： `Jan 01 02:03:04。 67 - 警告 - ConnectionBus_Queries: (1/4) 查询在 642 秒和694 毫秒内完成: 更新 "somemodule$someentity"`

## 4 数据库连接数

### 4.1 连接库

下面的设置用于定义数据库连接池行为。 运行时使用一个可重复使用的数据库连接库。 例如，您可以定义可以使用多少连接。 正在使用 [Apache Commons Object-hont API 实现连接池](http://commons.apache.org/pool/)。

| 名称                           | 值                                                                                                                                                                    | 默认值 |
| ---------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --- |
| `ConnectionPoolingMaxActive` | 设置池中活动实例总数的上限。                                                                                                                                                       | 50  |
| `连接 PoolingMaxIdle`          | 设置池中的“空闲”实例数量上限。                                                                                                                                                     | 50  |
| `连接PoolingMinIdle`           | 设置拆解器线程(如果活动的话)生成新对象之前允许在池中使用的对象的最小数量。 请注意， `numActive` + `numIdle` >= `maxActive` 时没有创建对象。  如果闲置对象驱逐器被禁用，此设置将不会产生任何效果(意思是，如果 `timeBetweenEvictionRunsMillis` <= 0). | 0   |

{{% alert type="info" %}}
如果您更改了这些设置，您需要重新启动您的应用以应用更改。
{{% /报警 %}}

{{% alert type="info" %}}
这些设置已配置为每个运行时实例的 **。 如果您有 [缩放了您的应用程序](/developerportal/deploy/scale-environment)， 数据库侧的连接数将乘以运行场数。 例如，如果您将 `ConnectionPoolingMaxIdle` 设置为 `50` 并将您的应用程序缩放到 2 个运行时间。 每个运行时实例最多将创建50个连接，但在数据库侧，这将导致最多100个连接。
{{% /报警 %}}

当更改 `ConnectionPoolingMaxIdle` and `ConnectionPoolingMinIdle` 设置时，请考虑以下几点：

* 更多空闲连接意味着更多内存使用
* 更多空闲连接意味着在启动查询时减少开销，因为连接本身不需要创建
* 较少空闲连接意味着减少内存使用
* 开始查询时，空闲连接较少意味着更多的间接费用，因为连接本身需要创建

最有趣的设置是 `ConnectionPoolingMaxActive`， 因为这将在任何时间点平行运行的查询总数。 Mendix 应用程序中此值的默认设置是50。 这意味着在任何特定时间最多可以同时运行50个查询。 对于大多数应用程序，这将是一个非常安全的数字，因为大多数查询只需要毫秒， 所以需要很多同时使用的用户到达50个查询并行运行的点。 当应用始终处于其连接池限制时，您会遇到如下错误：

* `警告 - ConnectionBus: 数据库连接: 50个活动, 0 空闲.`
* `错误 - ConnectionBus: Opening JDBC 连接到1.2.3。 :5432 与 SQLState失败: null 错误代码: 0 消息: 无法获取连接, 池错误: 等待空闲对象重试的超时...(1/4)`

And/or 你得到一个看起来像这样的DB连接池图表：

![](attachments/tricky-custom-settings/mendix-customsettings-tricky-img1.png)

它将很可能将 `ConnectionPoolingMaxActive` 增加到一个更高的数字。 但如果以下内容属实，这不是采取的正确行动：

* 在应用程序日志中显示长时间运行的查询——在这种情况下，首先尝试并修复这些查询更加合理。 否则您将最终进入相同的问题 但在应用程序开始后需要更长的时间 (重新)
* 一个数据库内存内存中运行不足，甚至经常失去内存——在这种情况下。 首先升级数据库节点大小更符合逻辑。
    * 在这种情况下，它也可能会在您的应用程序日志中找到长时间运行中的查询
* 只有几个用户会话在任何时间处于活动状态 — — 您的应用程序可能需要重新计算除非您能解释为什么三个用户经常使用50个并行数据库连接

然而，如果以下全部为真，你应该将 `ConnectionPoolingMaxActi` 增加到一个更高的数字：

* 有大量的并行用户 (意味着至少几千)
* 应用程序日志中没有长时间正在运行的查询， 即使使用 `LogMinDurationQuery` 设置为一个相对较低的数字 (如3秒)
* 在任何时候都有大量的数据库内存

1. 一般情况 我们看到将 `ConnectionPoolingMaxActive` 增加到一个更高的数字，很少能采取正确的行动。 即使不幸的是，当您进入连接池问题时通常采取的行动。s

此外， 请记住，要更改在 Mendix Cloud v3 中运行的应用程序的这个值还需要对数据库节点进行调整，只有Mendix 能够做出调整。 因此，在改变价值之前， 请在 [Mendix Support Portal](https://support.mendix.com/hc/en-us) 中提交一个工单，说明您打算更改该数值的数字。 当您的应用程序在 Mendix Cloud v4 中运行时，您可以在不改变数据库节点的情况下更改值。

## 5 阅读更多

* [运行时自定义](/refguide/custom-settings)
