---
title: "预定事件"
parent: "资源"
menu_order: 80
description: "配置预定事件的选项"
tags:
  - "预定事件"
  - "执行属性"
  - "D. 时间安排"
  - "间隔"
  - "计划问题"
  - "时区"
  - "日光保存"
---

## 1 导言

在预定的事件中，您可以让运行时间在特定时间执行微流。 这次活动也可以在一定时间内重复，例如每天一次。

一个预定的事件被添加到您的模块作为文档(右键单击您的模块，您会在 *添加其他* 下找到它)。

{{% alert type="warning" %}}
计划中的事件可以在本地测试，但如果您的应用被部署为免费应用，它们将不会运行。 请参阅 [Mendix Cloud 的免费应用部分](/developerportal/deploy/mendix-cloud-deploy#free-app) 获取关于免费应用限制的更多信息。
{{% /报警 %}}

每次运行您的应用模型中定义的预定事件时，都会创建一个 `调度事件信息` 对象。 记录以下内容：

* **名称** — **已经输入的** 预定事件的名称 [常见属性](#common-properties)
* **描述** - 输入的预定事件的 **文档** [共同属性](#common-properties)
* **开始时间** - 这次运行预定事件的时间
* **结束时间** - 这次活动结束的时间
* **状态** — — 此预定事件运行的当前状态：
    * **运行** - 该事件目前正在运行，尚未结束
    * **已完成** - 事件已成功完成
    * **错误** - 事件完成时出错——您可以使用 *开始时间* 和 *结束时间* 在必要时找到错误日志中的错误
    * **停止** - 预定的事件在完成之前就停止了，例如应用程序被停止或集群节点变得不健康

{{% alert type="warning" %}}
`调度事件信息` 对象未被自动清除。 如果您有大量的预定事件，您需要决定您需要多长时间保留此信息并删除不再需要的陈旧对象。
{{% /报警 %}}

## 2 通用属性{#common-properties}

| 财产 | 描述                                                                    |
| -- | --------------------------------------------------------------------- |
| 名称 | 预定活动的名称。 此名称存储在运行时间的 `ScheduledEventInformation` 对象中，因此计划活动的运行是可以识别的。 |
| 文件 | 此字段仅用于文档的应用模型。 其值对最终用户不可见，不会在开发者门户中显示，不会影响您的应用程序的行为。                  |


## 3 执行属性

| 财产  | 描述                                                                                                 |
| --- | -------------------------------------------------------------------------------------------------- |
| 微流  | 执行预定事件时执行的微流。 它应该没有参数并与所有权限一起运行(见 [Microflow](microflow))。                                         |
| 已启用 | 只有在预定事件启用时才执行微流。 此设置仅在从 Studio Pro 或 Eclipse 运行时适用。 在生产环境中，通过平台工具（如开发者门户或Windows服务控制台）启用/禁用计划中的事件。 |

## 4 计时属性

| 财产      | 描述                                                                                                                        |
| ------- | ------------------------------------------------------------------------------------------------------------------------- |
| 开始日期/时间 | 首次执行预定事件的日期和时间。 如果开始日期/时间是 **UTC** 时间, 当它是 UTC 指定时间时执行预定的事件(通用协调时间)。 如果起始日期/时间是 **服务器** 时间 预定的事件是在您的应用程序运行的服务器上指定的时间时执行的。 |
| 重复      | 如果重复设置为 **是** ，预定的事件将与指定的时间间隔重复(例如，每5分钟)。                                                                                 |
| 间隔      | 这个数字和间隔类型表示两个事件之间的间隔有多大。 此数字应该大于零。                                                                                        |
| 间隔类型    | 区间类型决定区间的单位。 加上间隔，它表明两个事件之间的间隔有多大。 例如，1天或10分钟。                                                                            |

## 5 其他资料

### 5.1 计算间隔

平台按固定时间安排预定的事件。 这意味着平台在启动时安排下次迭代/间隔的预定事件。 这是通过检索间隔完成的，此外，平台也做了一些计算。

秒、分钟、小时、日和周的安排与配置完全相同。

数月和年份可能无法执行，如你所期望的：

* **月** 被解释为 *31天间隔*
* 一个 **年** 作为 *365天间隔*

当您使用月份或年份安排活动时, 因为它们可能无法在您所期望的日期运行。

例如，如果您安排一个事件在3月1日开始，每隔一个月： 随后它将于4月1日、5月2日、2日、3月3日、3日、3日、3日等地运作。

这是Mendix 5.3.2 释放如何计算间隔的简化例子。 后来的释放可能略有不同。

```java
switch(scheduledEvent.getIntervalType())
□
    case SECOND:
        timeUnit = TimeUnity. 经济周期；
        = 预定事件。 etInterval();
        间歇;
    案例联合国科特迪瓦特派团：
        时间单位 = 时间单位 INUTES;
        间隔 = 计划事件。 etInterval();
        间歇;
    案例HOUR：
        时间单位 = 时间单位 OURS;
        间隔 = 计划事件。 etInterval();
        间歇;
    cases DAY：
        timeUnit = TimeUnit。 AYS;
        间隔 = 计划事件。 etInterval();
        休息时间;
    case WEEK：
        timeUnit = TimeUnit。 AYS;
        间隔 = 计划事件。 etInterval()*7；
        休息；
    案例监控：
        时间单位 = 时间单位。 AYS;
        间隔 = 计划事件。 etInterval()*31；
        休息；
    YEAR案件：
        timeUnit = TimeUnit。 AYS;
        间隔 = scheduledEvent.getInterval()*365;
        休息;
}
```

{{% alert type="warning" %}}

如果在一个月的某一天运行一个预定的活动是绝对关键的, 您应该安排每日运行这个事件，然后检查这个月是否是运行它的恰当时间。

在您的微流程中，您应该以使用如下表达式的决定开头：

```java
parseInteger( 格式化日期( [%CurrentDateTime%], 'dd) ) = 15
// 这将在月15日运行预定的事件
```

要在月份的最后一天运行它，您可以使用 [Herbert Vujik](https://mxforum.mendix.com/questions/6934/How-are-monthly-Scheduled-Events-planned#10518) 的这个建议：

```java
formatDateTime([%CurrentDateTime%], 'dd') = formatDateTime([%EndOfCurrentMonth%], 'dd') 
```
{{% /报警 %}}

### 5.2 指定时间

除了每月和每年排定的活动外，还有其他活动。 如果每日事件需要在某个特定时间运行，您也想在安排每日事件时要小心些。 这是因为日光节省时间。

每当您设置一个事件在某个时间每天运行时，它将在指定时间开始。 然而，在这之后它将在一个固定的时间间隔内运行(内部计算为每个X纳米秒)。 这意味着每隔24小时运行一个每天的事件。 Therefore, if the time changes because of daylight saving, your event *could* be an hour off.

这取决于您服务器托管的区域(时区)。 即使您选择 **UTC** 时间 如果您在一个采用日光节省的国家，您仍然会经历这种时间转移。 由于日光节余改变了UTC 的冲抵。

不幸的是，在这个问题上没有大的工作可做。 如果计划的事件必须在特定时间运行，您可以创建一个类似于上述的解决方案。 按小时调度事件，并使用 'HH' (0-23小时)，或 'kk ' (1-24小时)，而不是在日期格式表达式中的 'dd' 。 请记住，这将增加 `已创建事件信息` 对象的数量。

### 5.3 长跑事件

如果重复的预定事件所需时间超过间隔，则下一个预定事件将被推迟，事件将不会同时发生。 例如， 如果每5分钟重复一个预定的事件，但需要10分钟，则下一个事件将延迟5分钟。
