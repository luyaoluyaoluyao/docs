---
title: "异常性迁移"
parent: "数据存储"
menu_order: 30
tags:
  - "studio pro"
---

## 1 导言

唯一的验证约束通常在数据库中处理。 这样就能够有效地处理无国籍集群、更多的并行使用者以及更多的应用程序。

以下规则可以在数据库中验证：

* 关于实体属性的唯一规则
* *多面* 一对多个关联， *两边* 一对一关联

然而，也可以在运行时进行数据验证，并在以后为数据库添加独一无二的验证。 当它已经包含数据时。 如果您稍后在某个日期应用更严格的规则，数据库中的数据将必须符合您的新验证规则。

本文件讨论：

* 添加数据库唯一性约束对您项目的影响
* 当您更改域模型验证时，如何迁移现有数据
* 您如何确保您现有的数据，这些数据可能与您当前的验证规则不兼容 符合您现有的项目模型，以便您可以在Mendix 中部署数据库约束

迁移工具包可用来帮助您修复数据库中数据与模型中定义的验证规则之间的任何不一致之处。

关于 *异常校验*设置的更多信息，见 [Project 设置](project-settings)。

## 2 个唯一属性

### 2.1 运行时统一性验证的效果

如果您的 Mendix 应用程序使用运行时间验证， 您可以在不影响当前数据的情况下更改一个实体，并在属性上添加一个独特的验证规则。 例如， 您可以在您的域模型中指明，一个保险编号在数据库中应该是独特的，因为您想要使用它来独特地识别某人。

![](attachments/datastorage/attr-uniq-validation-rule.PNG)

应用验证规则不会影响在您使用更严格的数据模型之前已经存储在数据库中的用户。 与现有人员相比，只有新的人员才能检查保险号码的独特性。

这样做的好处是，更严格的模型不影响目前的数据。 缺点是很容易对数据库中数据的独特性作出错误的假设。 例如，微流中的逻辑可能取决于独特的保险号码。 而且存在保险编号重复的旧数据很容易被忽略。

### 2.2 统一审定的当前情况

使用运行时验证的唯一性已被弃用。 然而，在删除之前，我们正在提供一个运行时间设置： 如果设置为 **数据库**, 将会在数据库级别强制执行唯一的验证规则。

![](attachments/datastorage/uniqueness-validation-setting.PNG)

我们强烈建议将此无线电按钮设置为 **数据库**。 这将为未来版本的 Mendix 准备您的应用。 如果无线电按钮仍被设置为 **Runtime**，则将出现一个废弃警告：

![](attachments/datastorage/deprecation-warning.PNG)

### 2.3 数据库统一性验证的效果

选择 **数据库** 的效果是，当您部署了一个具有唯一验证规则的模型属性(现有规则或新规则) 将检查受影响实体的所有现有对象的属性。 如果保险编号相同的多人：

* 如果您从 Studio Pro中部署应用，部署时将显示错误
* 如果您从部署包中部署了应用程序(例如在 Mendix 云中)， 应用程序将不会启动，错误将被写入日志

![](attachments/datastorage/startup-error.png)

### 2.4 使用数据库唯一性验证的限制

如果您正在使用另一个专门化的实体(一般化)，使用数据库唯一性验证会有限制。

启用数据库唯一性验证选项， 您不能定义专门化实体中唯一的验证规则，用于来自此实体的一般化属性。 如果您这样做，将报告一致性错误，如在这张图像中：

![](attachments/datastorage/unique-validation-rule-unresolved.png)

然而，您可以定义一个独特的验证规则，用于在专门实体中添加的属性。

---

例如，你有两个实体：

* 一个普通实体 **员工** 具有属性 **员工编号**
* 一个专业实体 **SalesEmployee**, 基于 *Employee* 具有属性 **Email地址**

每一个 *SalesEmployee* 将有一个 *Employee 号码* 与 *Employee* 实体相同。 然而，您不能在 *SalesEmployee* 实体中设置验证规则，使 *Employee Number* 唯一。

然而，您可以设置验证规则使 *电子邮件地址* 独一无二，因为该属性仅出现在 *SalesEmployee* 实体中。

---

您可以简单地解决这个问题，将这些属性的唯一验证规则移动到它定义的属性的一般化实体。

![](attachments/datastorage/unique-validation-rule-resolved.png)

## 3 独特协会

协会的情况也是类似的。 请考虑以下示例：

![](attachments/datastorage/one-to-many-assoc.PNG)

起初，域模型包含 **地址** 和 **人员** 之间的一对一的关联。 这意味着一个人可以有多个地址。 一段时间后，数据结构会改变，因为逻辑已被添加到应用程序中，每个人只允许一个地址。 适当的数据建模指将社团变成一对一社团。 新数据将正确反映更新的关联。

![](attachments/datastorage/one-to-one-assoc.PNG)

数据库中现有的社团数据也必须遵守最新的一对一社团。 在部署时进行检查。 如果一个人有多个地址，模型将不会部署， 并且在Studio Pro或(Mendix)部署日志中出现错误：

![](attachments/datastorage/startup-error-assoc.png)

我们对现有数据实施这种新的更严格的联系，以避免轻易被忽略的错误，这种错误只能使每个人返回一个地址（事实上，每个人在数据库中仍然有多个地址）。 Mendix Platform 每次运行时始终返回相同的地址，但其他地址将是数据库中隐藏条目。

## 4 个移徙帮助

为了帮助迁移您的旧数据，Mendix 开发了一个迁移工具包。 详情请联系 [Mendix Support](http://support.mendix.com)。
