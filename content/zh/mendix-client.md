---
title: "Mendix 客户端"
category: "Mendix 运行时间"
description: "运行时间的 Mendix 客户端部分及其如何运作的描述"
menu_order: 20
tags:
  - "运行时间"
  - "mendix 客户端"
  - "离线前"
  - "浏览器"
  - "javascript"
  - "nanoflows"
  - "小部件"
  - "启动"
---

## 1 导言

Mendix 客户端运行在最终用户的设备上，并处理最终用户和应用程序之间的接口。 有时它可以完全独立于运行时服务器并在本地执行所有处理。 大多数情况下，它与 Runtime 服务器交互，以获取或更新共享数据，或执行附加应用程序逻辑。

Mendix 客户端的这种描述是基于使用运行于云端的应用程序的 Runtime Server。 您也可以在本地运行 Mendix 进行测试，但这在概念上是一样的。

## 2 个描述

Mendix 客户端用于使用 Mendix 构建的所有应用程序：web、mobile 和混合物。

对于 **web 应用程序**, Mendix 客户端作为单一页面应用程序。 这意味着所有分页都由 Mendix 客户端处理，而不是使用不同的 URL作为单独的网页。 Mendix 客户端是通过从 *主题提供的 HTML 页面加载一个 `mxui.js` 脚本来启动的。*

对于 **移动应用程序** Mendix 客户端作为React本地应用。 这意味着由 Mendix 创建的应用由两个部分组成： *包装* 和 *捆绑*。 包装器是一个原生的 iOS 或 Android 应用程序，它加载捆包并显示平台功能。 捆包包括客户端核心、插件小部件和应用程序专用资源，如nanoflows和页面。

支持移动应用程序的三种包装类型如下：

* [使它成为本机应用](getting-the-make-it-native-app)
* [自定义开发者应用](/howto8/mobile/how-to-devapps)
* [本机应用](/howto8/mobile/deploying-native-app)

The first two of these load a bundle dynamically, while the last one includes a pre-packaged bundle that can be [updated](/howto8/mobile/how-to-ota) later.

**混合应用程序**，对于大多数用途来说，可以被视为一个在浏览器中运行的应用程序。 然而，在这种情况下， 浏览器嵌入移动应用程序中，可以通过 [Cordova](https://cordova.apache.org/) 插件访问移动设备的某些功能。 我们建议您使用原生移动应用，而不是混合应用，如果您想要制作在移动设备上运行的Mendix 应用程序。

下面是显示Mendix 客户端组件的图表。 每个组件在下图表中说明。

![Mendix 客户端的组成](attachments/runtime/mendix-client.png)

### 2.1 客户核心。

这可以被视为客户端的解释器。 它使用客户端配置和客户端状态来决定如何处理最终用户的请求。 客户核心控制为满足请求而需要进行的各种过程。 这些过程包括数据获取和操作、客户端表达式和导航。

客户端核心由 JavaScript 编写。

Mendix 应用程序不修改客户端核心，所有逻辑都保存在模型中。 但是，每个补丁版本的 Mendix 都有自己的客户核心版本。

### 2.2 部件

这些是Mendix 客户端的基本组成部分。 客户端采取的所有行动都由小部件控制。 他们负责页面上显示的内容以及用户输入的管理方式。 在 [小部件](#widgets)下面有一个更详细的小部件描述。

### 2.3 Javascript 操作

这将运行自定义的 JavaScript ，这是由应用程序开发者添加的，作为客户端配置中的 JavaScript 动作。

### 2.4 界面图层

界面图层进行导航、资源加载和平台集成。 它负责根据Mendix 客户的行动建立向最终用户提供的网页。 使用正确的语言和其他语言设置。

### 2.5 HTTPS 服务器

HTTPS 服务器服务于在模型中持有的页面、小部件和javascript动作，服务于应用程序的最终用户。

### 2.6 原理

这将运行客户端逻辑，模型中定义为 nanoflows 。

### 2.7 平台 APIs

这些是Mendix 客户端运行环境的功能。 在大多数情况下，这将是摄像头或GPS位置等移动设备的函数。 但它也可以包括拨打Mendix Native API或浏览器函数，如访问图像文件。

### 2.8 客户配置

这是Mendix 客户端需要的静态数据。 对于基于浏览器的客户端，该数据与运行时服务器在线保存。 对于本机移动应用，这是在本地设备上进行的。

这些包括启动Mendix 客户端所需的初始环境 (例如浏览器外壳页面) 定义应用程序主题的级层样式表(ss文件)和定义客户端逻辑的 JavaScript 文件。

### 2.9 数据 API

这允许Mendix 客户端获取和操纵离线存储或 Mendix Runtime中的数据。

### 2.10 对象缓存

这将持有和管理Mendix 客户端在内存中正在使用的对象 - 例如不可持续的物体。 新的对象和 Runtime 服务器返回的对象显示在一个页面上。 它还对这些物体的属性和协会进行了修改。

国家处理将进行垃圾收集，以确保在不再需要时释放记忆。

### 2.11 离线存储

这是永久性存储，通常是在移动设备上，在移动设备上可以为正在离线模式下运行的应用存储数据。 它不同于临时对象存储空间，因为在会话结束时数据不会丢失。 但一直保持到它可以同步到 Runtime 服务器。

### 2.12 状态/同步

这管理到 Runtime 服务器的请求。 请注意，Mendix 客户端中的一些操作将不需要访问 Runtime 服务器。 例如，如果对象缓存已经有权访问临时对象存储中所需的数据。 或者如果应用被写为“离线优先”。

关于Mendix 客户端和 Runtime 服务器之间通信的更多信息，请参阅 [Mendix Runtime](communication-patterns) 中的通信模式。

#### 2.12.1 国家处理

这将把应用程序的当前状态 (保存在对象缓存中) 传输到 Runtime 服务器。 由于状态是在 Mendix 客户端保存的，运行时服务器可能是无国籍的。 这将确保更容易通过添加更多实例来横向缩放您的应用，因为任何实例都可以处理任何请求。

为了避免性能问题，Mendix 客户端不会将整个状态发送到运行时间。 国家处理决定哪些部分应在应用部署过程中通过分析模型来发送。

欲了解更多关于状态的详细信息，请查阅这个博客： [https://www.mendix.com/blog/the-art-of-state-part-1-introductionto-the-client-state/](https://www.mendix.com/blog/the-art-of-state-part-1-introduction-to-the-client-state/)。 这还包括一个可操作的示例，您可以在那里看到并为自己复制状态传递到运行服务器的方式。

国家处理也负责收集垃圾。 如果你想要更多地了解这个问题，请查看这个博客： [https://www.mendix.com/blog/the-art-of-state-part-2-garbage-collection/](https://www.mendix.com/blog/the-art-of-state-part-2-garbage-collection/)。

#### 2.12.2 同步

如果应用程序是“离线优先”，则在应用程序中创建和更改的数据将在本地存储，直到它与运行时服务器同步。 这项工作是通过同步过程进行的。 这将使离线存储和对象缓存与 Runtime 服务器同步。 欲了解离线第一个应用和同步的更多信息，请参阅 [离线第一个](offline-first)。

#### 2.12.3 会 议

这将确保运行时的任何会话都能保持存活并在必要时恢复。 它还作为所有需要的运行时间通信的认证。

### 2.13 运行时服务器

运行时服务器正在等待来自Mendix 客户端的请求，处理请求并返回请求的数据，以及任何相关的附加状态信息。 这是通过一个名为 *xas* 的私有API来完成的。

它还会在更改应用程序时通知Mendix 客户端， 并允许开发者将调试器连接到客户端以调试 nanoflow。

由于所有信息都被发送到Mendix 客户端来构建页面，因此Mendix 客户端的一切都是对最终用户可见的。 在 Runtime Server 中执行安全操作，它只会向Mendix 客户端发送用户可以看到的信息。

关于运行时服务器的描述，请参阅 [运行时服务器](runtime-server)。

## 3 小部件{#widgets}

Mendix 页面是从单个小部件构建的。 一个小部件可以是以下类型之一：

* 核心部件 - Mendix 客户端的部分
* 插件——基于 React 或 React Native, 由用户编写或从市场下载的
* 自定义小部件 - 基于 Dojo，用户编写或从市场下载的

下文各节对此作了说明。

### 3.1 核心部件

Mendix 有一些核心小部件支持Mendix 页面的标准功能。 核心小部件是核心客户端的一部分。 大多数这些小部件都有本地和网络实现，不过有些小部件仅限于一个平台。

在本地移动应用程序中，使用了基于React本地框架的实现。 在 web 应用程序中，实现基于React 或 Dojo。 使用 Dojo 的小部件有一些限制，例如它们不能在 [插件中使用](/apidocs-mxsdk/apidocs/property-types-pluggable-widgets-8#widgets)。 这些道场实现正在逐步被替换。

### 3.1 插件部件

你也可以在核心小部件不足的情况下写下你自己的小部件，称为 **插件**。 可通过市场下载插件。 它们是基于 React (网页应用程序) 或 React Native (本机移动应用程序) 的, 并且是推荐的编写小部件的方式。 它们替换下面描述的自定义部件。

欲了解更多信息，请参阅 [插件API](/apidocs-mxsdk/apidocs/pluggable-widgets)。

### 3.2 自定义部件

您也可以写入 **个自定义小部件**。 这些基于 Dojo 框架，仅在网络应用程序中运行。 他们可以使用不同的、低级的 API 和可插拔的小部件。 仅当您不能在 Pluggable 小部件中创建功能时，才能使用自定义小部件。

关于自定义小部件的更多信息，请参阅 [如何构建自定义小部件](/howto8/extensibility/widget-development)。

## 4 Mendix Client Startup

当最终用户想要使用 Mendix 应用程序时， 他们需要在设备上启动客户端，然后才能连接到 Runtime 服务器。 此操作的方式取决于运行客户端所使用的方法。 这可以是以下内容之一：

* 浏览器
* 原生移动应用程序

Mendix 客户端是如何启动的，在下面的章节中作了描述。

### 4.1 在浏览器中启动 Mendix 客户端

在浏览器中，环境是建立在初始页面“shell”上的，代码是引导的。

#### 4.1.1 发射流

当最终用户在浏览器中启动应用程序时，它会触发以下流程。

1. 最终用户在浏览器中输入应用程序的 URL。

2. 浏览器加载HTML网页("shell")。

3. 网页加载并启动Mendix 客户端以及核心部件。

4. Mendix 客户端加载任何自定义小部件。

5. Mendix 客户端联系运行时服务器并验证最终用户。

6. Mendix 客户端获取运行时服务器所需的任何额外配置。


    *Mendix 客户端已准备好开始与最终用户互动，并且只要最终用户的会话继续，将重复以下步骤。*

7. Mendix 客户端加载页面定义。

8. 页面上使用的 Mendix 客户端加载插件。

9. Mendix 客户端从运行时服务器检索所需的任何数据。

10. Mendix 客户端构建页面。

11. Mendix 客户端向最终用户显示页面。

12. Mendix 客户程序从最终用户输入并重复上面的步骤来显示正确的页面。


#### 4.1.2 Mendix 客户端资源的位置

当应用被部署时，静态资源被放置在一个叫做CDN的结构中。 这包括以下方面：

* 索引. tml - 当最终用户启动Mendix 客户端时加载的初始HTML页面——它包含客户端配置和其他静态非Mendix 内容(例如，如果谷歌分析被添加到应用程序中)
* mxui.js — — Mendix 客户端的主要代码
* 应用样式/阿特拉斯法——指定页面如何显示的应用特定的 css 样式和静态视觉元素
* 小部件 — — — 本应用使用的本地和网络核心小部件
* 页面定义 - xml 页面定义，这些定义告诉Mendix 客户端这个应用程序的页面是什么样的

### 4.2 启动原生Mendix 客户端

本地移动应用启动时的流量不同于浏览器中的启动流量。 更多的信息作为应用的一部分存储在本地，本地移动应用甚至可以被设计为运行“离线优先”， 这意味着它仍然可以在没有任何连接到 Runtime 服务器的情况下运行。

这里描述的流程是用于生产应用。 在开发过程中，流量不是一样的。 这使您能够做更快的部署和在线调试。

1. 最终用户在他们的设备上打开应用程序。 这是一个项目特定的 shell 应用，它本来就在 iOS 或 Android 上运行。 它发布到适合设备的应用商店。 如果应用程序的新版本已下载到设备， 即使最终用户已经在他们的设备上打开，应用的行为也会好像是第一次打开它。

2. 外壳应用程序加载本机捆绑。 这相当于在浏览器中运行的 Mendix 客户端使用的 Mendix 客户端资源。 例如，它包含Mendix 客户端代码和页面定义。 然而，它是在当地安装的，而不是与运行时服务器集中安装的。

3. 如果设备上没有有效的身份验证令牌， Mendix 客户端联系运行服务器并验证最终用户并获取运行服务器所需的任何额外配置。

4. 如果这是第一次启动该应用，或是第一次更新该应用， Mendix 客户端执行与 Runtime 服务器的同步。

5. Mendix 客户端检查存储在 Visual Studio 应用中心的资源是否更新到本机捆绑。 这将使应用能够随时更新，无需从应用商店下载新版本的应用。

    *Mendix 客户端已准备好开始与最终用户互动，并且只要继续运行，将重复以下步骤。*

6. Mendix 客户端使用设备上的数据准备页面。

7. Mendix 客户端将页面展示给最终用户。

8. Mendix 客户端响应最终用户输入。
