---
title: "予定されたイベント"
parent: "リソース"
menu_order: 80
description: "スケジュールされたイベントを構成するためのオプション"
tags:
  - "予定されたイベント"
  - "実行プロパティ"
  - "タイミング"
  - "間隔"
  - "スケジュールの問題"
  - "タイムゾーン"
  - "夏時間の節約"
---

## 1つの紹介

スケジュールされたイベントを使用すると、ランタイムが特定のタイミングでマイクロフローを実行できるようになります。 イベントは、例えば毎日、特定の間隔で繰り返すこともできます。

スケジュールされたイベントがドキュメントとしてモジュールに追加されます (モジュールを右クリックすると、 ** の下に表示されます)。

{{% alert type="warning" %}}
スケジュールされたイベントはローカルでテストできますが、アプリが無料アプリとしてデプロイされている場合は実行されません。 無料アプリの制限に関する詳細については、 [Mendix Cloud](/developerportal/deploy/mendix-cloud-deploy#free-app) の無料アプリセクションを参照してください。
{{% /alert %}}

アプリモデルで定義されているスケジュールされたイベントが実行されるたびに、 `ScheduledEventInformation` オブジェクトが作成されます。 これは以下を記録します。

* **名前** - スケジュールされたイベントの **名前** [共通プロパティ](#common-properties)
* **説明** – **共通プロパティ** に入力されたスケジュールされたイベントの [ドキュメント](#common-properties)
* **StartTime** - スケジュールされたイベントのこの実行が開始された時間
* **EndTime** - スケジュールされたイベントのこの実行が終了した時間
* **状態** – スケジュールされたイベントのこの実行の現在の状態:
    * **** を実行中 - イベントは現在実行中で、まだ終了していません
    * **** 完了しました - イベントは正常に完了しました
    * **Error** - エラーで完了したイベント — 必要に応じて、 *StartTime* と *EndTime* を使用してエラーログのエラーを見つけることができます。
    * **Stopped** – スケジュールされたイベントが完了する前に停止しました。例えば、アプリが停止したり、クラスターノードが不健全になったりするなど。

{{% alert type="warning" %}}
`ScheduledEventInformation` オブジェクトは自動的にはクリアされません。 スケジュールされたイベントが多数ある場合は、この情報を保持する時間を決定し、不要になったときに古いオブジェクトを削除する必要があります。
{{% /alert %}}

## 2つの共通プロパティ{#common-properties}

| 属性     | 説明                                                                                              |
| ------ | ----------------------------------------------------------------------------------------------- |
| 名前     | スケジュールされたイベントの名前。 この名前は実行時に `ScheduledEventInformation` オブジェクトに格納されるため、スケジュールされたイベントの実行が認識可能です。 |
| ドキュメント | このフィールドは、アプリモデルのドキュメントのみを目的としています。 その値はエンドユーザーには表示されず、開発者ポータルに表示されず、アプリケーションの動作に影響を与えません。       |


## 3 実行プロパティ

| 属性      | 説明                                                                                                                                                                   |
| ------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| マイクロフロー | スケジュールされたイベントが実行されたときに実行されるマイクロフロー。 パラメータを持たず、すべての権限で実行する必要があります ( [Microflow](microflow) を参照)。                                                                      |
| 有効      | マイクロフローは、スケジュールされたイベントが有効な場合にのみ実行されます。 この設定は、Studio Pro または Eclipse から実行する場合にのみ適用されます。 本番環境では、プラットフォームツール(開発者ポータルや Windows サービスコンソールなど)を介してスケジュールされたイベントが有効/無効になります。 |

## タイミングのプロパティ

| 属性        | 説明                                                                                                                                                                                       |
| --------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 開始日時      | スケジュールされたイベントが最初に実行された日時。 開始日時が **UTC** の場合、スケジュールされたイベントは UTC (Universal Coordinated Time) で指定された時刻のときに実行されます。 開始日時が **サーバー** 時間の場合。 スケジュールされたイベントは、アプリケーションが実行されるサーバー上の指定された時間で実行されます。 |
| 繰り返し      | 繰り返しが **はい**に設定されている場合、スケジュールされたイベントは指定された間隔で繰り返されます。                                                                                                                                    |
| 間隔        | インターバルタイプとともに、この数字は、2つのイベントの間隔がどれくらい大きいかを示します。 この数値はゼロより大きくなければなりません。                                                                                                                    |
| インターバルタイプ | interval 型により、間隔の単位が決まります。 インターバル番号と一緒に、2つのイベントの間隔がどれくらい大きいかを示します。 例えば、1日または10分。                                                                                                         |

## 5つの追加情報

### 5.1 間隔の計算

プラットフォームは、スケジュールされたイベントを一定の間隔でスケジュールします。 つまり、起動時に、プラットフォームはスケジュールされたイベントが実行される次の繰り返し/間隔をスケジュールします。 これは間隔を取得することによって行われ、さらにプラットフォームはいくつかの計算を行います。

秒、分、時間、日、および週は構成されているようにスケジュールされています。

月と年は期待通りに実行されない場合があります。

* **月** は *31 日の間隔* と解釈されます
* **年** を *365 日の間隔* として

月または年を使用してイベントをスケジュールするときは注意してください。期待している日には実行されないかもしれません。

たとえば、3月1日に1ヶ月間隔でイベントを開始する予定がある場合。 その後、5月2日、6月2日、7月2日、8月3日、9月3日などに実行される。

これは、Mendix 5.3.2 リリースがどのように間隔を計算したかの実装の簡単な例です。 以降のリリースでは少し異なる動作をする可能性があります。

```java
switch(scheduledEvent.getIntervalType())
{
    case SECOND:
        timeUnit = TimeUnit.SECONDS;
        interval = scheduledEvent.getInterval();
        break;
    case MINUTE:
        timeUnit = TimeUnit.MINUTES;
        interval = scheduledEvent.getInterval();
        break;
    case HOUR:
        timeUnit = TimeUnit.HOURS;
        interval = scheduledEvent.getInterval();
        break;
    case DAY:
        timeUnit = TimeUnit.DAYS;
        interval = scheduledEvent.getInterval();
        break;
    case WEEK:
        timeUnit = TimeUnit.DAYS;
        interval = scheduledEvent.getInterval()*7;
        break;
    case MONTH:
        timeUnit = TimeUnit.DAYS;
        interval = scheduledEvent.getInterval()*31;
        break;
    case YEAR:
        timeUnit = TimeUnit.DAYS;
        interval = scheduledEvent.getInterval()*365;
        break;
}
```

{{% alert type="warning" %}}

その月の特定の日にスケジュールされたイベントを実行することが絶対に重要である場合。 イベントのスケジュールを毎日実行してから、これが月の正しい日か確認してください。

マイクロフローでは、次のような式を使用して意思決定を開始する必要があります。

```java
parseInteger( formatDateTime( [%CurrentDateTime%], 'dd') ) = 15
// これは月の15日にスケジュールされたイベントを実行します。
```

月の最終日に実行するには、 [Herbert Vujik](https://mxforum.mendix.com/questions/6934/How-are-monthly-Scheduled-Events-planned#10518) からこの提案を使用できます :

```java
formatDateTime([%CurrentDateTime%], 'dd') = formatDateTime([%EndOfCurrentMonth%], 'dd') 
```
{{% /alert %}}

### 5.2 時刻を指定する

月間および年間スケジュールされたイベントに加えて、 日々の予定を決める時にも気をつけてください これは昼間の時間を節約するためです。

特定の時間に毎日実行するイベントを設定すると、指定された時間に開始されます。 しかし、この後は一定の間隔で実行されます(内部的にはXナノ秒ごとに実行するために計算されます)。 これは、毎日のイベントが24時間ごとに実行されることを意味します。 したがって、昼間の節約によって時間が変化した場合、あなたのイベント *は* 1時間休みになる可能性があります。

これはサーバがホストしているロケール(タイムゾーン)によって異なります。 たとえ **UTC** timeを選択した場合でも もし昼間の節約を受け入れる国にいるとしたら 夏時間によってUTCからのオフセットが変わります

残念ながら、この問題に対する大きな回避策はありません。 スケジュールされたイベントを特定の時間に実行する必要がある場合は、上記のようなソリューションを作成できます。 イベントを毎時スケジュールし、日付フォーマットの式で「dd」ではなく「HH」(0-23時間)または「kk」(1-24時間)を使用します。 これにより、作成された `ScheduledEventInformation` オブジェクトの数が増えます。

### 5.3 長い実行中のイベント

繰り返されるスケジュールされたイベントが間隔よりも時間がかかる場合、次のスケジュールされたイベントが遅延します。イベントは同時に実行されません。 例えば、 スケジュールされたイベントが5分ごとに繰り返され、イベントが10分かかる場合、次のイベントが5分遅れます。
