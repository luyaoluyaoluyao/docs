---
title: "イベントハンドラー"
parent: "エンティティ"
menu_order: 50
tags:
  - "ドメインモデル"
  - "エンティティ"
  - "イベントハンドラ:"
---

イベントハンドラは、エンティティに関連する特定のイベントを処理するマイクロフローを定義します。 選択したモーメントとタイプに応じて、マイクロフローはオブジェクトを作成、コミット、削除、またはロールバックする前後に実行されます。

{{% alert type="warning" %}}

イベントハンドラを適度に使用します。 イベントハンドラは、対応するイベントが発生するたびにトリガーされるため、常に実行したいものになります。 特定の形式で何かを起こしたい場合は、ローカルマイクロフローを使用することができます。たとえば、自作の Save ボタン。

{{% /alert %}}{{% alert type="warning" %}}

イベントハンドラは特定の順序でトリガーされません。 そのため、イベントが相互に何らかの方法で依存しないことを確認します(一般化および専門化のイベントに関しても)。

{{% /alert %}}

## プロパティー

### Moment

このプロパティは、指定されたイベントの前後にマイクロフローが実行されるかどうかを定義します。

| 値 | 説明                               |
| - | -------------------------------- |
| 前 | マイクロフローは、指定されたイベントが発生する前に実行されます。 |
| 後 | マイクロフローは、指定されたイベントが発生した後に実行されます。 |

### イベント

このプロパティは、マイクロフローの実行をトリガーするイベントを定義します。

| 値        | 説明                                                                                                                                                                                                        |
| -------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 作成       | マイクロフローは、このエンティティのオブジェクトが作成されたときに実行されます。 これは、グリッド上の **Create** ボタン、またはマイクロフロー内にオブジェクトを作成する際にユーザーがクリックすると発生します。 マイクロフローの作成アクションでは、オブジェクトがデフォルト値で初期化された後、After Create が実行されます。 しかし、アクションで指定された変更項目が適用される前に。 |
| コミット     | このエンティティのオブジェクトがコミットされると、microflow が実行されます。 これは、ユーザーがフォーム上の保存ボタンをクリックした場合、またはマイクロフロー内のオブジェクトをコミットした場合に発生します。                                                                                              |
| 削除       | このエンティティのオブジェクトが削除されると、マイクロフローが実行されます。 これは、ユーザーがグリッド内の削除ボタンをクリックした場合、またはマイクロフロー内のオブジェクトを削除した場合に発生します。                                                                                                     |
| Rollback | マイクロフローは、このエンティティのオブジェクトがロールバックされたときに実行されます。 これは、ユーザーがフォーム内のキャンセルボタンをクリックした場合、またはマイクロフロー内のオブジェクトをロールバックした場合に発生します。                                                                                        |

### マイクロフロー

このプロパティは、指定したイベントに対して実行されるマイクロフローを定義します。 マイクロフローは、イベントハンドラの瞬間とイベントに応じて、特定のパラメータと戻り値の型を持つ必要があります。

*   'before create' を除くすべてのイベントハンドラのマイクロフローは、パラメータとしてイベントが発生するオブジェクトを取得します。
*   _の前に_ 実行されるマイクロフロー イベントは、イベントを継続するか (True) キャンセルするか (False) を指定する Boolean 値を返す必要があります。 複数のマイクロフローが同じイベントを処理する場合、いずれかのマイクロフローが False を返すと直ちにキャンセルされます。 その場合、一部のマイクロフローがまったく実行されない場合があります。 この機能を使用すると、特定の条件が満たされていない場合にオブジェクトのコミットをキャンセルすることができます。

| Moment | イベント     | オブジェクトをパラメータとして取得します | ブール値を返します |
| ------ | -------- | -------------------- | --------- |
| 前      | 作成       | いいえ                  | はい        |
| 後      | 作成       | はい                   | いいえ       |
| 前      | コミット     | はい                   | はい        |
| 後      | コミット     | はい                   | いいえ       |
| 前      | 削除       | はい                   | はい        |
| 後      | 削除       | はい                   | いいえ       |
| 前      | Rollback | はい                   | はい        |
| 後      | Rollback | はい                   | いいえ       |

### microflow が false を返ったときにエラーを発生させます(Moment が 'Before' の場合のみ)

このオプションを有効にすると、microflow が false を返すと、イベントハンドラはエラーを発生します。 エラー処理を使用して、イベントハンドラが false を返したかどうかを検出できます。 これにより、'before commit' イベントハンドラはネイティブ検証のようになります。 このオプションが無効になっている場合 'before commit' イベントハンドラはコミットの実行を止めることしかできませんが、残りのマイクロフローはまだ実行されます。

_デフォルト値:_ はい
