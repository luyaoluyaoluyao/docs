---
title: "ワークフロー定義の更新"
parent: "ワークフロー"
menu_order: 60
tags:
  - "ワークフロー"
  - "ワークフロー"
  - "バージョン"
  - "更新"
---

## 1つの紹介

ワークフローは長い間実行されているプロセスです。 ワークフロー定義が変更されると、 タスクまたはアクティビティがワークフロー定義から追加または削除され、ワークフローの実行インスタンスがまだ存在する可能性があります。

新しいワークフロー定義がデプロイされ、ランタイムが開始されると、実行中のワークフローインスタンスが存在する最新の定義にアップグレードされます。 つまり、既存のワークフローインスタンスは正常に動作し続けることができます。 これらのインスタンスは、その瞬間から最新のワークフロー定義に従います。

ただし、実行中のワークフローインスタンスをアップグレードできない場合があります。

この文書では、両方の事例について詳しく説明します。

## 2 最新のワークフロー定義へのアップグレードに成功しました

以下の変更のいずれかが競合していないと解釈されます。

* 現在のワークフローによって実行されていないパスにアクティビティを追加する
* 現在のワークフローで実行されているパス内のアクティビティを削除します
* 現在のワークフローで実行されているパス内のアクティビティの並び替え
* アクティビティまたは結果のプロパティの変更:
* * 名前、キャプション、タイトルの変更
  * **microflow** アクティビティの 参照されているマイクロフローの変更、または **ワークフローコール** アクティビティ内の参照されているワークフローの変更
  * ユーザータスク内の参照ページの変更
  * ユーザータスクのユーザー割り当てまたはユーザー割り当てオプションの変更
  * ユーザータスクの期日を変更する
* **決定**、 **マイクロフロー** または **ユーザー タスク** アクティビティを呼び出します。
* コンテキストエンティティ、参照されているマイクロフロー、参照ページ、または参照されているワークフロー

## 最新のワークフロー定義にアップグレードする際の3つの競合があります

ランタイムは、最新のワークフロー定義にアップグレードする際に、次の状況が競合していることを検出します。

* 最新の **WorkflowDefinition** (e. をクリックします。ワークフローインスタンスが現在待機しているユーザータスクは、その定義から完全に削除されました。
* 既に実行されているパスに並列パスが導入されます
* すでに実行されているパスにアクティビティが導入されます
* 選択した結果が置き換えられました
* すでに実行されているアクティビティは、 **WorkflowDefinition** で再実行される場所に移動されます。
* コンテキストのエンティティが変更されました
* **ワークフロー定義** が削除されました

{{% alert type="info" %}}

実際のワークフローによっては、上記の状況が機能的に問題を引き起こさない可能性があります。 もちろん、これはビジネスドメインの事前知識が必要です。 その結果、ランタイムは、ビジネスの観点から厳密に必要とされるよりも多くの競合を検出する可能性があります。

{{% /alert %}}

競合するワークフローインスタンスは状態 **互換性のない** でマークされます。 **Reason** フィールドは、発見された競合を説明するテキストで更新されます。 この状態ではワークフローを実行できません。

{{% alert type="info" %}}

システムは、互換性のないワークフローインスタンスを状態 **InProgress** に変更し、後続のアプリ展開が **WorkflowDefinition** を競合しなくなると自動的にアップグレードできます。

{{% /alert %}}

## 4 システムモジュールエンティティ

ランタイムは起動時に次のシステムエンティティのデータを追加または変更します。

* ワークフロー定義への変更が検出されたとき
* 新しい **WorkflowVersion** インスタンスが作成されます (前のインスタンスを参照してください)
* **WorkflowDefinition** が、現在のバージョンとして新しい **WorkflowVersion** を指すように変更されました。

 **WorkflowVersion** インスタンスは、モデルのそのバージョンに存在するすべての **WorkflowTaskDefinition** インスタンスを参照します。

詳細については、 [ワークフロー](workflows#workflow-entities) セクションの *ワークフロー* を参照してください。

## 3 続きを読む

* [ワークフロー](workflows)