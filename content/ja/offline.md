---
title: "オフライン"
category: "全般"
menu_order: 40
---

## 1つの紹介

我々は、オフラインアプリケーションを、 [ハイブリッドタブレットプロファイル](hybrid-tablet-profile) および/または [ハイブリッド電話プロファイル](hybrid-phone-profile) からアクセス可能なMendixアプリの一部として定義します。 オフラインサポートを有効にする必要があります。 これらのプロファイルで利用可能なページは、インターネット接続なしで表示できます。 したがって、これらは以下に説明するいくつかの制限の対象となります。

## 2種類の在庫あり

オフラインアプリケーションにアクセスするには、正しく設定された [PhoneGap](http://phonegap.com/) ハイブリッド・アプリケーションを実行するモバイルデバイスが必要です。 アプリは、サーバーから必要なリソースをダウンロードするために、最初に開いたときにインターネット接続が必要になります。 最初の同期後も、インターネットに接続されていなくても、アプリ内でデータが利用可能になります。 インターネット接続がある場合でも、オフラインプロファイルは使用されますのでご注意ください。

## 3 同期 {#synchronization}

[オフライン対応](configuring-hybrid-mobile-apps-to-run-offline) モバイルアプリケーションが最初に実行されると、サーバーからオフラインで実行するために必要なすべてのデータを取得します。 その後、同期イベントがトリガーされるまでオフラインモードになります。 オフラインモードのままにすると、アプリケーションのパフォーマンスが大幅に向上します。 サーバーまたはユーザーのいずれかによって同期をトリガーできます。 新しいモデルがアップロードされた後に開かれた場合、サーバーは自動的にアプリを再同期化し、矛盾を防ぎます。 ユーザーは、たとえば [アクション ボタン](action-button) から同期アクションをトリガーすることにより、同期をトリガーできます。

{{% alert type="info" %}}

Mendix 7.6の時点で、オフラインアプリの起動パフォーマンスは、後続のアプリケーション起動時にデータとファイル同期をスキップします。 Mendixはそれらを引き続き実行しますが、その間にアプリが再デプロイされた場合に限ります。 この場合、同期は 2 つのステップで構成されます: 新規オブジェクトと変更されたオブジェクトのアップロード 実行時に必要なすべてのオブジェクトをダウンロードしてデータベースを再作成します。

{{% /alert %}}

アップロード時に、ユーザーが新たに作成したオブジェクトがサーバー上に作成されます。 そして、new と changed オブジェクトはコミットすることによってサーバにアップロードされます。 これらのオブジェクトに関連するイベントハンドラは、通常通り実行されます。 この処理中に同期アクションにエラーが発生した場合、アップロードプロセス全体が元に戻されます。 たとえば、10 個のオブジェクトがアップロードされ、これらのいずれかのコミットが検証エラーを引き起こすと、10 個のオブジェクトはすべて失われます。 これは、新しく作成したオブジェクト間の内部の一貫性を確保するためです。 例えば、ユーザーが複数の注文行を持つ注文を作成し、注文がコミットに失敗した場合。 トランザクション全体がロールバックされ、注文がなくてもデータが破損するのを防ぎます。

ダウンロード中、オフラインデータベースは削除され、競合を避けるために再作成されます。 その後、データベースは、オフラインプロファイルで使用されるすべてのオブジェクトを照会することによって埋められます。

同期は通常のランタイムAPIに依存するため、アプリのモデルとランタイムは互換性がある必要があります。 これは、新しいバージョンのアプリケーションをデプロイするときに重要です。 たとえば、オフラインで表示されるエンティティの `Brand` 属性を削除した場合、 `Car`古いバージョンのオフラインアプリを使っている誰かが車のブランドを変更すると同期中にエラーが発生します したがって、経験則として、オフラインで表示されるエンティティまたはその属性の種類を削除、名前の変更、または変更することはありません。

ファイルの同期は、ファイル自体の内容を変更することではなく、オブジェクトの属性への変更によってのみトリガーされます。

{{% alert type="warning" %}}上記の理由により同期エラーが発生した場合。 オブジェクトのコミットはスキップされ、その変更は無視され、他のオブジェクトからの参照は無効になります。 このようなスキップされたオブジェクト(エラーをトリガーしていない)を参照しているオブジェクトは正常に同期されます。 このような状況はモデリングエラーになる可能性があり、{{% /alert %}}

## 4つの制限 {#restrictions}

### 4.1 マイクロフロー

必要なすべてのロジックを処理するサーバーがなければ、Mendix クライアントから実行されるmicroflow はオフラインページで機能できません。 これは、データソースマイクロフローからオン変更アクションまで、クライアント側のすべてのマイクロフローに適用されます。 クライアントのスコープ外で実行されるすべてのマイクロフローは、引き続き実行されることに注意してください。 例えば、before-commit microflow を使用して複雑なロジックを処理することができます。 開発者が最初のセーブではなく、同期で実行されるという事実を認識している限り。

### 4.2 XPath

オフラインで使用するためにモバイルデバイスにデータを保存するために使用されるデータベースは、複雑なクエリに対応していません。 このため、オフラインのデバイスプロファイルを介してアクセス可能なすべてのウィジェットで XPath 設定が許可されません。 あるいは、データベースデータソースに含まれる単純な制約を使用するとともに、エンティティアクセスを使用して複雑なクエリをモデリングすることもできます。

### 4.3 データソース

上記で説明されている XPath とマイクロフローの両方の制限のため、データベースデータソースのみがオフラインで使用することができます。

### 4.4 検索

検索の動作はデータベースクエリに依存しているため、現在、オフライングリッドとリストビューでは検索が利用できません。

### 4.5 データ操作

Mendix 7.4.0以前は、オフラインページでは新しいオブジェクトの作成のみがサポートされていました。 オンラインデータベースからインポートされたオブジェクトは表示できますが変更できません。 オブジェクトは、作成と同期の間でのみ編集できます。

Mendix 7.4.0 からは、同期後にオブジェクトを編集することもできます。

### 4.6 オートンバーと計算された属性

autonumbers と計算された属性の両方にはサーバーの介入が必要であり、したがって許可されていません。 これらの属性タイプを持つオブジェクトはオフラインで表示および作成できますが、属性自体は表示できません。

### 4.7ファイル

オフラインでのファイルの保存とアップロードはサポートされていません。 System.FileDocument の専門分野はオフラインで作成できますが、ファイルのアップロードやダウンロードはできません。 このルールの例外は System.Imageで、いつものように画像ビューアーでアクセス、閲覧、アップロード、ウィジェットのアップロードが可能です。

### 4.8 デフォルトの属性値

ドメインモデル内のエンティティのデフォルトの属性値は、オフラインで作成されたオブジェクトに影響を与えません。 ブール属性は常に `false`、数値属性は `0`、その他の属性は `空` にデフォルトになります。

### 4.9 関連付け

参照に続く属性パスはグリッド列では使用できません。 また、参照セットセレクタは使用できません。

また、参照セットの関連(カスタム ウィジェットなどを介してアクセス)の使用はサポートされていません。

### 4.10 継承

一般化/専門化関係から複数のエンティティを使用することはできません。 オフラインページまたはオフラインのnanoflowで2つ以上の関連エンティティを使用すると、同期が失敗します。 なぜなら、これらのエンティティのオブジェクトは同じ ID を持つデータベースに複数回挿入されるからです。

### 4.11 システムメンバー

システムメンバー (`createdDate`, `changedDate`, `owner`, `changedBy`) はサポートされていません。

### 4.12 Excel/CSV エクスポート

スプレッドシートは、オフラインでは使用できない直接のデータベース操作によって生成されます。

### 4.13 プラットフォーム

オフライン対応アプリは、iOSおよびAndroidプラットフォームでのみサポートされています。

オフラインアプリの詳細については、 [ハイブリッドモバイルアプリをオフラインで実行するための設定](configuring-hybrid-mobile-apps-to-run-offline) を参照してください。

### 4.14 同期

Mendixには、同期処理に推奨される最大アプリサイズがありません。 このプロセスは、データの量と、モバイルデバイスの接続品質と速度に依存します。

The timeout is set to 30 seconds per entity downloaded by [July 3rd, 2018 Hybrid App Base & Template](/releasenotes/mobile/hybrid-app#7318) release.

加えて、 Mendixは、ユーザーが必要としないエンティティを同期しないようにセキュリティアクセスを構成することによって、可能な限りデータの量を制限し、同期することを推奨します。

### 4.15 読み取り専用属性

オフラインアプリから参照のみの属性を持つオブジェクトの作成と同期には制限があります。 オフラインアプリはアクセスルールを知らないため、すべての属性を編集するためにオブジェクトをオフラインで作成するユーザーを許可します。 ユーザが実際に書き込み権限を持っているかどうかに関係なく オブジェクトを同期すると、そのオブジェクトをコミットするときにアクセスルールが適用されるため、エラーが発生します。

既存のオブジェクトの変更には適用されませんのでご注意ください。
