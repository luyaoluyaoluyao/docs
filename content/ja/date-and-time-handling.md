---
title: "日付 & 時間の処理"
category: "Mendix Runtime"
---

## 1つの紹介

Mendix Server操作は、サーバのタイムゾーンの代わりにユーザのタイムゾーンを使用します。 以前は、ドキュメントの生成、Excel/CSVへのエクスポート、マイクロフロー/OQLでの日付計算などの操作がすべてサーバーのタイムゾーンを使用していました。 サーバーとアプリケーションのすべてのユーザーが同じタイムゾーンにいる場合、これは問題ありません。 ただし、生成された出力には予期しない結果が含まれる場合があります。

## 関連する2つのタイムゾーン

Mendixアプリケーションで動作する3つのタイムゾーンがあります。

1.  ユーザ/クライアント: クライアントが実行されているタイムゾーンは、エンドユーザーへの日付と時刻を表示するために使用されます。 日照時間を適切に処理するために、各ユーザーにタイムゾーンが(オプションで)保存されるようになりました。 タイムゾーンが設定されていない場合、夏時間(DST)は適用されません。
2.  Coordinated Universal Time (UTC): プラットフォームはすべての日付をUTCタイムゾーンに保存します。 これは、明確な日付フォーマットを提供するために多くの場合、サーバーで使用される時間標準です。 季節の変化(DST)では変わりません。 ユーザーに日付や時刻が表示されるたびに、クライアントのタイムゾーンにローカライズされます。
3.  サーバー: サーバーが実行しているタイムゾーンは、スケジュールされたイベントの実行時間のスケジュールにのみ使用されます。 スケジュールされたイベントを定義する場合は、サーバ時刻とUTC時刻のどちらを使用するかを選択できます。 それ以外のすべての場合、サーバーの時間は関係ありません。

短縮のために、これらのタイムゾーンのユーザー時間、UTC、およびサーバー時間を呼び出します。

## 3つの変更

サーバは各ユーザのタイムゾーンを知る必要があります。 残念ながら、ウェブブラウザはこの情報を報告することはできません。 現在のオフセットはUTCにのみ報告します。 これは、正確な時間帯を決定するのに十分ではありませんし、将来の日付や過去の日付の昼間の節約時間を適切に処理します。 このため、Webアプリケーションはタイムゾーンを設定するオプションを提供することが多く、今ではMendixにもこのオプションを組み込んでいます。 ユーザーごとにタイムゾーンを明示的に設定することができ、このタイムゾーンはサーバー操作に使用されます。

エンティティのTimeZoneは、UserとTimeZoneの関連付けとともにSystemモジュールに追加されました。 TimeZoneエンティティには3つの属性があります。コード(Olsonデータベースに基づく)です。 ユーザー ("(GMT-05:00) ニューヨーク) に表示するのに適した説明と、タイムゾーンのリストの並べ替えに使用する生のオフセットです。

format@@0モジュールで、Account_NewEditフォームにタイムゾーンセレクタが追加され、ユーザのタイムゾーンが設定されます。 デフォルトでは、MyAccountのフォームにはこのセレクタがありません。 タイムゾーンを正しく設定するのが管理者の仕事です。 エンドユーザーが自分のタイムゾーンを設定できるようにしたい場合は、自分で追加できます。

モデラーは、プロジェクトの設定ダイアログに設定を追加します。 「Model」タブでは、デフォルトのタイムゾーンを指定できます。 このタイムゾーンは新規ユーザーに使用されます。 アプリケーションの起動時にタイムゾーンを持っていないすべてのユーザーにも適用されます。

## 4 既存のプロジェクト

新しい日付/時刻の処理を使用するには、既存のプロジェクトを変換した後にいくつかのアクションを実行する必要があります。 これらのアクションはプロジェクトのタイプによって異なります:単一のタイムゾーンまたは複数のタイムゾーンです。 単一のタイムゾーンプロジェクトでは、すべてのユーザがタイムゾーンにいるか、少なくとも同じタイムゾーンを使用しても構わない。 サーバーのタイムゾーンは重要ではありません つまり、すべてのユーザーがオランダにいるが、サーバーがイギリスにある場合、プロジェクトはまだ単一のタイムゾーンです。 複数のタイムゾーンプロジェクトには、異なるタイムゾーンのユーザーがいます。 それぞれの場合に必要なことを見てみましょう。

### 4.1 シングルタイムゾーンプロジェクト

サーバーがタイムゾーンにある単一のタイムゾーンプロジェクトで何もしない場合、サーバー操作の状況は実際には以前よりも若干悪くなります。 ユーザはタイムゾーンを持たず、サーバがWebブラウザで送信されるUTCからの現在のオフセットを使用する場合。 このオフセットは正確なタイムゾーンを決定するのに十分ではなく、これは日照時間(DST)が考慮されないことを意味します。 実際には、これは、未来と過去の日付と時刻―過去のDST変更―が1時間休みであることを意味します。

すべてのユーザーが自分のタイムゾーンを設定していることを確認する は、モデラーのプロジェクト設定でデフォルトのタイムゾーンを設定する必要があります。 アプリケーションが再び起動されると、既存のすべてのユーザーがこのデフォルトのタイムゾーンを取得します。 また、新規ユーザーが作成されると、このデフォルトのタイムゾーンも自動的に取得されます。

まとめると 単一のタイムゾーンプロジェクトでは、Modelerのデフォルトのタイムゾーンを設定するだけで完了です。

### 4.2 マルチタイムゾーンプロジェクト

複数のタイムゾーンプロジェクトで何もしない場合、サーバー操作の状況は自動的に改善されます。 以前は、サーバのタイムゾーンはExcelのエクスポートや他のドキュメントを生成する操作に使用されていました。 これは、中国のユーザーがレポートを生成し、サーバーが米国の日付と時刻にある場合には、オフになることを意味します。 サーバは少なくともブラウザのUTCオフセットを使用します。 夏時間のみが適切に処理されません。 適切なDST処理を行うには、ユーザーのタイムゾーンを設定する必要があります。

複数のタイム ゾーン プロジェクトでできることはいくつかあります。

*   何もありません。 サーバー操作を何も行わない場合、ユーザーの現在のUTCオフセットを使用し、これは実際にタイムゾーンを設定する合理的な近似値です。 DSTのみが適切に処理されません。
*   ユーザーが自分のタイムゾーンを設定できるようにします。 デフォルトの MyAccount で、ユーザが自分のアカウントを管理できるフォームにタイムゾーン参照セレクタを追加します。 これを行う場合、タイムゾーンはユーザーがログアウトし、再度ログインした後にのみ効果的に更新されることに注意してください。
*   管理者がタイムゾーンを設定します。 デフォルトの Account_NewEdit in Administration で、管理者がアカウントを管理するフォームにタイムゾーン参照セレクタを追加します。 アプリケーションがあまりにも多くのユーザーを持っていない場合、これは実行可能な解決策です。
*   マイクロフローを使用してタイムゾーンを自動的に設定します。 アプリケーションがいくつかのタイムゾーンで使用されている場合、タイムゾーンを設定するために起動後のマイクロフローを記述できるタイムゾーンを自動的に決定することができます。 例えば、 アプリケーションが米国およびオランダで使用され、米国のすべてのユーザーがアメリカ英語に設定されており、オランダのすべてのユーザーがオランダ語に設定されている場合、マイクロフローはすべてのユーザーを通してループすることができ、ユーザーの言語コードに基づいてタイムゾーンを設定できます。

{{% alert type="warning" %}}

すべてのユーザーにデフォルトのタイムゾーンを設定するため、複数のタイムゾーンプロジェクトにモデラーのデフォルトのタイムゾーン設定を使用しないでください！

{{% /alert %}}

## 5人の匿名ユーザー

アプリケーションにサインインせずにアクセスできる場合、これらの匿名ユーザーはModelerで設定されているデフォルトのタイムゾーンを取得します。 モデラーでタイムゾーンが設定されていない場合は、ブラウザによって報告されたオフセットを使用します。 将来と過去の日付のDSTのみが適切に処理されません。

## 6ローカライズまたはローカライズしない場合

DateTime 型の属性ごとに、日付と時刻をローカライズするかどうかを指定できます。 これは新しい機能ではなく、このページで言及する価値があります。 ローカライズされた属性と非ローカライズされた属性はどちらもUTCに保存されますが、ローカライズされた属性のみが値を表示するときにユーザーのタイムゾーンに変換されます。 時間コンポーネントに興味がない場合は、非ローカライズされた属性を使用します (例えば、 誕生日)または日付を世界中でまったく同じにしたい場合。

詳細については、 [属性](attributes) のローカライズプロパティのドキュメントを参照してください。

## 7トークン

[%BeginOfCurrentDay%] のような特定の瞬間を参照するためのトークンがユーザーのタイムゾーンを参照するようになりました。 それが理にかなっているところでは、例えば、UTCバージョンのトークンが追加されています [%BeginOfCurrentDayUTC%]。
